# 经典实现 - 数组相关

> 这里记录了高频的函数实现
> 每个实现没有难易之分，了解其背后的原理才是最重要的

<!-- 简易锚点，id需要使用英文名称 -->

## 目录 

* <a href="#push">push</a>
* <a href="#pop">pop</a>
* <a href="#every">every</a>
* <a href="#some">some</a>
* <a href="#filter">filter</a>
* <a href="#forEach">forEach</a>
* <a href="#find">find</a>
* <a href="#flat">flat</a>
* <a href="#empty">检验空数组</a>
* <a href="#includes">includes</a>
* <a href="#unshift">unshift</a>

## 数组

<h3 id="push">push</h3>

`push()`方法可向数组的末尾添加一个或多个元素，并返回新的长度。

```js
// by 余光
Array.prototype._push = function() {
  const arr = this;
  const len = arr.length;
  const args = arguments;
  for (let i = 0; i < args.length; i++) {
    arr[len + i] = args[i];
  }
  return arr.length;
};

// by zy
Array.prototype._push = function() {
  const arr = this;
  const len = arr.length;
  for (let i = 0; i < arguments.length; i++) {
    arr[len + i] = arguments[i];
  }
  return arr.length;
};
```


<h3 id="pop">pop</h3>

`pop()`删除数组最后一项，并返回被删除的值

```js
// by 余光
Array.prototype._pop = function() {
  const arr = this;
  const res = arr[arr.length - 1];
  arr.length = arr.length - 1;
  return res;
};

// by zy
Array.prototype._pop = function() {
  const arr = this;
  const result = arr[arr.length - 1];
  arr.length = arr.length - 1;
  return result;
};
```

<h3 id="every">every</h3>

对数组每项都运行传入的函数，如果对每项函数都返回 true，则这个方法返回 true

```js
// by 余光
Array.prototype._every = function(callback, target = this) {
  const arr = target;
  const len = arr.length;

  if (typeof callback != "function") {
    throw new Error(); // 这里参考zy的分析，添加参数兼容会比较好
  }
  if (len === 0) return []; // 如果为空数组，返回[]

  for (let i = 0; i < len; i++) {
    if (!callback(arr[i], i, arr)) {
      return false;
    }
  }
  return true;
};

// by zy
Array.prototype._every = function(cb, thisValue = this) {
  if (typeof cb != "function") {
    throw new Error();
  }
  if (thisValue.length == 0) {
    return true;
  }
  for (let i = 0; i < thisValue.length; i++) {
    if (!cb(thisValue[i], i, thisValue)) {
      return false;
    }
  }
  return true;
};
```

<h3 id="some">some</h3>

对数组每项都运行传入的函数，如果有一项返回`true`，则这个方法返回`true`

```js
// by 余光
Array.prototype._some = function(callback, target = this) {
  const arr = target;
  const len = arr.length;

  if (len === 0) return []; // 如果为空数组，返回[]

  for (let i = 0; i < len; i++) {
    if (callback(arr[i], i, arr)) {
      return true;
    }
  }
  return false;
};

// by zy
Array.prototype._some = function(cb, thisValue = this) {
  if (typeof cb != "function") {
    throw new Error();
  }
  if (thisValue.length == 0) {
    return false;
  }
  for (let i = 0; i < thisValue.length; i++) {
    if (cb(thisValue[i], i, thisValue)) {
      return true;
    }
  }
  return false;
};
```

<h3 id="filter">filter</h3>

对数组每项都运行传入的函数，函数返回 true 的项组成数组之后返回。

```js
// by 余光
Array.prototype._filter_ = function(callback, target = this) {
  const arr = target; // 保存this
  const result = []; // 返回新数组
  const len = arr.length;

  if (len === 0) return []; // 如果为空数组，返回[]

  for (let i = 0; i < len; i++) {
    if (callback(arr[i], i, arr)) result.push(arr[i]); //如果判定条件为true，保存至新数组
  }
  return result; // 返回符合条件的结果
};

// by zy
Array.prototype._filter = function(cb, thisValue = this) {
  const result = [];
  if (typeof cb != "function") {
    throw new Error();
  }
  if (thisValue.length == 0) {
    return [];
  }
  for (let i = 0; i < thisValue.length; i++) {
    if (cb(thisValue[i], i, thisValue)) {
      result.push(thisValue[i]);
    }
  }
  return result;
};
```


<h3 id="forEach">forEach</h3>

对数组每项都运行传入的函数，无返回值。

```js
// by 余光
Array.prototype._forEach = function(callback, target = this) {
  const arr = target; // 保存this
  const result = []; // 返回新数组
  const len = arr.length;

  if (len === 0) return []; // 如果为空数组，返回[]
  for (let i = 0; i < len; i++) {
    callback(arr[i], i, arr);
  }
  return; // 返回undefined
};

// by zy
Array.prototype._forEach = function(cb, thisValue = this) {
  const result = [];
  if (typeof cb != "function") {
    throw new Error();
  }
  if (thisValue.length == 0) {
    return;
  }
  for (let i = 0; i < thisValue.length; i++) {
    cb(thisValue[i], i, thisValue);
  }
  return;
};
```


<h3 id="flat">flat</h3>

**描述**

flat() 方法会按照一个可指定的深度递归遍历数组，并将所有元素与遍历到的子数组中的元素合并为一个新数组返回。

```js
// by 余光
// 递归方式
Array.prototype._flat = function(deep = 1) {
  // 获取调用者
  let arr = this;
  // 拍平层数校验
  if (deep < 1) return arr;
  //
  return arr.reduce(
    (prev, next, i, n) => [
      ...prev,
      ...(Array.isArray(next) ? next._flat(deep - 1) : [next]),
    ],
    []
  );
};

//zy
Array.prototype.myFlat = function(num = 1) {
  if (num < 0) return this;
  let arr = [];
  this.forEach((item) => {
    if (Array.isArray(item)) {
      arr = arr.concat(item.myFlat(--num));
    } else {
      arr.push(item);
    }
  });
  return arr;
};
```

<h3 id="find">find</h3>

ES6的find(..)和 some(..) 的工作方式一样，除了一旦回调返回 true/ 真值，会返回实际的数组值

* 当数组中的元素在测试条件时返回 true 时, find() 返回符合条件的元素，之后的值不会再调用执行函数。
* 如果没有符合条件的元素返回 undefined

```js
Array.prototype._find = function(fn, target) {
    const items = target || this;
    for (let i = 0; i < items.length; i++) {
        const cur = items[i];
        const index = i;
        const arr = items;
        if (fn(cur, index, arr)) {
            return cur;
        }
    }
    return undefined;
};
```

<h3 id="empty">检验空数组</h3>

> 判断是否是空数组

```js
const isNotEmpty = arr => Array.isArray(arr) && arr.length > 0;

console.log('test1:', isNotEmpty([1]));
console.log('test1:', isNotEmpty([]));
```

<h3 id="includes">includes</h3>

> 一个真正返回布尔值的数组搜索方法

```js
const _includes = (arr, target, fromIndex = 0) => {
    // 简单类型校验
    if(!Array.isArray(arr)) return new Error('Expecting an array');
    const len = arr.length; 
    // 索引校验
    if(fromIndex >= len){
        return false; // 不查询直接返回
    }
    let index = 0;
    if(fromIndex < 0 && fromIndex + len > 0){
        index = fromIndex + len;
    }
    for(let i = index; i < len; i++){
        if(arr[i] === target){
            return true
        }
    }
    return false;
}

_includes([1,2,3,4], 1, -1); // false
_includes([1,2,3,4], 4, 3); // true
```

<h3 id="unshift">unshift</h3>

> 新项添加到数组的开头，并返回新的长度。

```js
// by zy
Array.prototype.myUnshift = function(){
    for(let i= this.length-1 ;i>=0;i--){
        this[i+arguments.length] = this[i];
    }
    for( let i = arguments.length-1; i>=0;i--){
        this[i] = arguments[i]
    }

    return this.length;
}

```
